<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>ëª…í•¨ ì œì‘ í”„ë¡œê·¸ë¨ - ë‹¨ì¼ íŒŒì¼(ì˜¤ë¥˜ìˆ˜ì •)</title>
  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- html2canvas (ì´ë¯¸ì§€ ìº¡ì²˜) -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <!-- QRCode -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
  <!-- í•œê¸€ í°íŠ¸ -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard-dynamic-subset.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&family=Noto+Serif+KR:wght@400;600;700;900&family=Black+Han+Sans&display=swap">
  <style>
    html, body { height: 100%; }
    * { -webkit-tap-highlight-color: transparent; }
    .card { width: 336px; height: 192px; }
    @media (max-width: 420px){ .card { transform: scale(0.95); transform-origin: top center; } }
  </style>
</head>
<body class="bg-slate-50">
  <div class="min-h-screen p-3 sm:p-6">
    <div class="mx-auto max-w-6xl grid grid-cols-1 lg:grid-cols-[minmax(0,480px),1fr] gap-4 sm:gap-6">
      <!-- ì¢Œì¸¡: ì…ë ¥ íŒ¨ë„ -->
      <div class="bg-white rounded-2xl shadow p-4 sm:p-5">
        <div class="flex items-center justify-between mb-3">
          <h1 class="text-lg sm:text-xl font-semibold">ëª…í•¨ ì œì‘ í”„ë¡œê·¸ë¨</h1>
          <button id="resetBtn" class="text-xs px-3 py-1.5 rounded-full bg-slate-100 hover:bg-slate-200">ì´ˆê¸°í™”</button>
        </div>
        <div class="grid grid-cols-1 gap-2">
          <input id="name" class="w-full border rounded p-2" placeholder="ì´ë¦„" />
          <input id="title" class="w-full border rounded p-2" placeholder="ì§ì±…" />
          <input id="phone" class="w-full border rounded p-2" placeholder="ì „í™”ë²ˆí˜¸" />
          <textarea id="bio" rows="2" class="w-full border rounded p-2" placeholder="ìê¸°ì†Œê°œ (ì§§ê²Œ)"></textarea>
          <input id="email" class="w-full border rounded p-2" placeholder="ì´ë©”ì¼" />
          <input id="website" class="w-full border rounded p-2" placeholder="ì›¹ì‚¬ì´íŠ¸" />
          <input id="address" class="w-full border rounded p-2" placeholder="ì£¼ì†Œ" />

          <div class="grid grid-cols-2 gap-3 mt-1">
            <label class="text-sm text-slate-600">ë°°ê²½ìƒ‰
              <input id="bgColor" type="color" class="w-full h-10 rounded border border-slate-200 cursor-pointer" />
            </label>
            <label class="text-sm text-slate-600">ê¸€ì ìƒ‰ìƒ
              <input id="textColor" type="color" class="w-full h-10 rounded border border-slate-200 cursor-pointer" />
            </label>
          </div>

          <label class="text-sm text-slate-600">í°íŠ¸ (í•œê¸€)
            <select id="fontFamily" class="w-full px-3 py-2 rounded-xl border border-slate-200 focus:outline-none focus:ring-2 focus:ring-sky-400 shadow-sm">
              <option value="'Pretendard Variable','Noto Sans KR',system-ui,sans-serif">Pretendard</option>
              <option value="'Noto Sans KR',system-ui,sans-serif">Noto Sans KR</option>
              <option value="'Noto Serif KR',serif">Noto Serif KR</option>
              <option value="'Black Han Sans','Noto Sans KR',sans-serif">Black Han Sans</option>
            </select>
          </label>

          <label class="text-sm text-slate-600">ë¡œê³  (ì˜¤ë¥¸ìª½ ìƒë‹¨)
            <input id="logoInput" type="file" accept="image/*" class="block w-full text-sm" />
            <span id="logoStatus" class="text-xs text-slate-500 hidden">ì—…ë¡œë“œë¨ âœ“</span>
          </label>

          <div class="grid grid-cols-2 gap-2">
            <label class="text-sm text-slate-600">ë©´ ì„ íƒ
              <select id="side" class="w-full px-3 py-2 rounded-xl border border-slate-200">
                <option value="front">ì•ë©´</option>
                <option value="back">ë’·ë©´(ë¡œê³ +QR)</option>
              </select>
            </label>
            <label class="text-sm text-slate-600">í…œí”Œë¦¿(10)
              <select id="template" class="w-full px-3 py-2 rounded-xl border border-slate-200">
                <option value="1">1) í´ë˜ì‹ ì¢Œì¸¡ì •ë ¬</option>
                <option value="2">2) ì¢Œì¸¡ ì»¬ëŸ¬ë°”</option>
                <option value="3">3) í•˜ë‹¨ êµµì€ ë°”</option>
                <option value="4">4) ìš°ì¸¡ì •ë ¬ ë¯¸ë‹ˆë©€</option>
                <option value="5">5) ë¶„í•  ë ˆì´ì•„ì›ƒ</option>
                <option value="6">6) ì„¼í„° ì •ë ¬</option>
                <option value="7">7) ë„íŠ¸ íŒ¨í„´</option>
                <option value="8">8) ëŒ€ê° ê·¸ë¼ë””ì–¸íŠ¸</option>
                <option value="9">9) ë¼ìš´ë“œ+ì¸ì…‹</option>
                <option value="10">10) ë³´ë” ì•„ì›ƒë¼ì¸</option>
              </select>
            </label>
          </div>

          <div class="mt-2 grid grid-cols-1 sm:grid-cols-3 gap-2">
            <button id="savePngPc" class="px-3 py-2 rounded-xl bg-emerald-600 text-white hover:bg-emerald-700 text-sm">PC: PNG ë‹¤ìš´ë¡œë“œ</button>
            <button id="saveJpgPc" class="px-3 py-2 rounded-xl bg-amber-600 text-white hover:bg-amber-700 text-sm">PC: JPG ë‹¤ìš´ë¡œë“œ</button>
            <button id="shareMobile" class="px-3 py-2 rounded-xl bg-slate-900 text-white hover:bg-black text-sm">ëª¨ë°”ì¼: ê°¤ëŸ¬ë¦¬/ê³µìœ </button>
          </div>
        </div>
      </div>

      <!-- ìš°ì¸¡: ë¯¸ë¦¬ë³´ê¸° + ê°¤ëŸ¬ë¦¬ -->
      <div class="space-y-4">
        <div class="bg-white rounded-2xl shadow p-4 sm:p-5">
          <div class="flex items-center justify-between mb-3">
            <div>
              <div class="text-sm text-slate-600">ë¼ì´ë¸Œ ë¯¸ë¦¬ë³´ê¸°</div>
              <div class="text-xs text-slate-500">í¬ê¸°: 336Ã—192px (86Ã—54mm ë¹„ìœ¨)</div>
            </div>
            <button id="printBtn" class="px-3 py-1.5 rounded-full bg-sky-600 text-white text-sm hover:bg-sky-700">ì¸ì‡„ / PDF</button>
          </div>
          <div class="flex items-center justify-center">
            <div id="card" class="card relative rounded-2xl shadow-sm overflow-hidden">
              <!-- ë°ì½”ë ˆì´ì…˜ ì—˜ë¦¬ë¨¼íŠ¸ (í…œí”Œë¦¿ë³„ë¡œ í‘œì‹œ/ìŠ¤íƒ€ì¼ ë³€ê²½) -->
              <div id="decorA" class="hidden absolute left-0 top-0 bottom-0 w-2 opacity-70"></div>
              <div id="decorB" class="hidden absolute left-0 right-0 bottom-0 h-6 opacity-20"></div>
              <svg id="decorC" class="hidden absolute inset-0 w-full h-full" xmlns="http://www.w3.org/2000/svg"><defs><linearGradient id="g1" x1="0" x2="1" y1="0" y2="1"><stop offset="0%" stop-color="#000" stop-opacity="0"/><stop offset="100%" stop-color="#000" stop-opacity="0.25"/></linearGradient></defs><rect width="100%" height="100%" fill="url(#g1)"/></svg>
              <div id="decorD" class="hidden absolute -right-6 -bottom-6 w-32 h-32 opacity-20 text-black"></div>
              <div id="decorE" class="hidden absolute inset-0 rounded-2xl shadow-[inset_0_0_0_9999px_rgba(255,255,255,0.02)]"></div>
              <div id="decorF" class="hidden absolute inset-1 ring-1 ring-white/60 rounded-2xl"></div>

              <!-- ë¡œê³  -->
              <img id="logoImg" alt="logo" class="absolute top-3 right-3 max-h-12 max-w-24 object-contain hidden" />

              <!-- ì•ë©´ ë‚´ìš© -->
              <div id="front" class="absolute inset-4">
                <div id="nameOut" class="text-[20px] font-bold leading-tight"></div>
                <div id="titleOut" class="text-[12px] mt-0.5 opacity-90"></div>
                <div id="bioOut" class="text-[11px] mt-2"></div>
                <div id="contactOut" class="absolute left-4 bottom-3 text-[10px] leading-4 opacity-90 space-y-0.5"></div>
              </div>

              <!-- ë’·ë©´ ë‚´ìš© -->
              <div id="back" class="absolute inset-4 hidden">
                <img id="qrImg" alt="QR" class="w-20 h-20 rounded-md shadow absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2" />
                <div id="backText" class="absolute left-1/2 -translate-x-1/2 top-[60%] text-[11px]"></div>
              </div>
            </div>
          </div>
        </div>

        <div class="bg-white rounded-2xl shadow p-4 sm:p-5">
          <h2 class="text-sm font-semibold mb-2">íŒ</h2>
          <ul class="list-disc pl-5 text-sm text-slate-600 space-y-1">
            <li>ëª¨ë°”ì¼ì€ <b>ê°¤ëŸ¬ë¦¬/ê³µìœ </b> ë²„íŠ¼ìœ¼ë¡œ ì‚¬ì§„ì•±ì— ì €ì¥(ë¯¸ì§€ì› ë¸Œë¼ìš°ì €ëŠ” ìƒˆ íƒ­ì—ì„œ ê¸¸ê²Œ ëˆŒëŸ¬ ì €ì¥)</li>
            <li>PCëŠ” PNG/JPG ë²„íŠ¼ìœ¼ë¡œ <b>ë‹¤ìš´ë¡œë“œ í´ë”</b>ì— ì €ì¥ë©ë‹ˆë‹¤.</li>
            <li>ê¸€ì ìƒ‰ìƒì€ ì´ë¦„/ì§ì±…/ìê¸°ì†Œê°œ/ì—°ë½ì²˜/ë’·ë©´ í…ìŠ¤íŠ¸ê¹Œì§€ ëª¨ë‘ ë°˜ì˜ë©ë‹ˆë‹¤.</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ====== ìƒíƒœ ê´€ë¦¬ ======
    const KEY = 'business_card_simple_full_v1';
    const state = JSON.parse(localStorage.getItem(KEY) || 'null') || {
      name: 'í™ê¸¸ë™',
      title: 'ëŒ€í‘œ / ì´ì‚¬',
      phone: '010-1234-5678',
      bio: 'ì§„ì‹¬ìœ¼ë¡œ ì—°ê²°í•˜ê³ , ì„±ì¥ì„ ì„¤ê³„í•©ë‹ˆë‹¤.',
      email: 'hello@example.com',
      website: 'www.example.com',
      address: 'ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123',
      bgColor: '#0ea5e9',
      textColor: '#ffffff',
      fontFamily: "'Pretendard Variable','Noto Sans KR',system-ui,sans-serif",
      side: 'front',
      template: 1,
      logoDataUrl: '',
      qrDataUrl: ''
    };
    const save = () => localStorage.setItem(KEY, JSON.stringify(state));

    // ====== ê³µìš© ======
    const $ = (id) => document.getElementById(id);
    const card = $('card');
    const front = $('front');
    const back = $('back');

    function applyColors(){
      card.style.background = state.bgColor;
      card.style.fontFamily = state.fontFamily;
      const primary = state.textColor;
      // ì•ë©´ í…ìŠ¤íŠ¸
      $('nameOut').style.color = primary; $('nameOut').textContent = state.name || 'ì´ë¦„';
      $('titleOut').style.color = primary; $('titleOut').textContent = state.title || 'ì§ì±…';
      $('bioOut').style.color = primary; $('bioOut').textContent = state.bio || '';
      const contactLines = [];
      if (state.phone) contactLines.push('ğŸ“ ' + state.phone);
      if (state.email) contactLines.push('âœ‰ï¸ ' + state.email);
      if (state.website) contactLines.push('ğŸ”— ' + state.website);
      if (state.address) contactLines.push('ğŸ“ ' + state.address);
      $('contactOut').innerHTML = contactLines.map(t=>`<div style="color:${primary}">${t}</div>`).join('');
      // ë’·ë©´ í…ìŠ¤íŠ¸
      $('backText').style.color = primary; $('backText').textContent = state.website || state.email || state.phone || '';
    }

    function setAlign(align){
      const name = $('nameOut'), title=$('titleOut'), bio=$('bioOut');
      name.classList.remove('text-left','text-right','text-center');
      title.classList.remove('text-left','text-right','text-center');
      bio.classList.remove('text-left','text-right','text-center');
      const cls = align==='right'? 'text-right' : align==='center'? 'text-center':'text-left';
      name.classList.add(cls); title.classList.add(cls); bio.classList.add(cls);
    }

    function placeContact(pos){
      const c = $('contactOut');
      c.className = 'text-[10px] leading-4 opacity-90 space-y-0.5 absolute';
      if (pos==='br') c.className += ' right-4 bottom-3 text-right';
      else if (pos==='top') c.className += ' left-4 top-3';
      else c.className += ' left-4 bottom-3'; // ê¸°ë³¸: ì™¼ìª½ í•˜ë‹¨
    }

    function applyTemplate(){
      // ë°ì½” ì´ˆê¸°í™”
      ['decorA','decorB','decorC','decorD','decorE','decorF'].forEach(id=> $(id).classList.add('hidden'));
      setAlign('left');
      placeContact('bl');

      const tc = state.textColor; // í…ìŠ¤íŠ¸ ìƒ‰ìœ¼ë¡œ ì•…ì„¼íŠ¸ ì‚¬ìš©
      const A=$('decorA'), B=$('decorB'), C=$('decorC'), D=$('decorD'), E=$('decorE'), F=$('decorF');
      // ë„íŠ¸ íŒ¨í„´ ì¤€ë¹„
      D.innerHTML = '<svg viewBox="0 0 100 100" class="w-full h-full"><g fill="currentColor">' +
        Array.from({length:10}).map((_,r)=> Array.from({length:10}).map((__,c)=> `<circle cx="${5+c*10}" cy="${5+r*10}" r="1.2" />`).join('')).join('') +
      '</g></svg>';

      switch(Number(state.template)){
        case 1: // í´ë˜ì‹ ì¢Œì¸¡ì •ë ¬
          setAlign('left'); placeContact('bl'); break;
        case 2: // ì¢Œì¸¡ ì»¬ëŸ¬ë°”
          A.style.background = tc; A.classList.remove('hidden'); setAlign('left'); placeContact('bl'); break;
        case 3: // í•˜ë‹¨ êµµì€ ë°”
          B.style.background = tc; B.classList.remove('hidden'); setAlign('left'); placeContact('bl'); break;
        case 4: // ìš°ì¸¡ì •ë ¬ ë¯¸ë‹ˆë©€
          setAlign('right'); placeContact('br'); break;
        case 5: // ë¶„í•  ë ˆì´ì•„ì›ƒ
          // ì˜¤ë¥¸ìª½ ì˜ì—­ ë¹„ì£¼ì–¼: íˆ¬ëª… ì˜¤ë²„ë ˆì´ë¡œ ëŒ€ì²´
          B.style.height='100%'; B.style.background = tc + '20'; B.classList.remove('hidden');
          setAlign('left'); placeContact('bl'); break;
        case 6: // ì„¼í„° ì •ë ¬
          setAlign('center'); placeContact('top'); break;
        case 7: // ë„íŠ¸ íŒ¨í„´
          D.style.color = tc; D.classList.remove('hidden'); setAlign('left'); placeContact('bl'); break;
        case 8: // ëŒ€ê° ê·¸ë¼ë””ì–¸íŠ¸
          C.querySelector('linearGradient stop[offset="0%"]').setAttribute('stop-color', tc);
          C.querySelector('linearGradient stop[offset="100%"]').setAttribute('stop-color', tc);
          C.classList.remove('hidden'); setAlign('left'); placeContact('bl'); break;
        case 9: // ë¼ìš´ë“œ+ì¸ì…‹
          E.classList.remove('hidden'); setAlign('left'); placeContact('br'); break;
        case 10: // ë³´ë” ì•„ì›ƒë¼ì¸
          F.classList.remove('hidden'); setAlign('left'); placeContact('bl'); break;
        default:
          setAlign('left');
      }
    }

    function toggleSide(){
      if (state.side==='front'){ front.classList.remove('hidden'); back.classList.add('hidden'); }
      else { back.classList.remove('hidden'); front.classList.add('hidden'); }
    }

    function updateQR(){
      const text = state.website || state.email || state.phone || '';
      if (!text){ state.qrDataUrl=''; $('qrImg').classList.add('hidden'); return; }
      let payload = text; if (text.includes('@')) payload = 'mailto:'+text; else if (/^\+?\d[\d -]{7,}$/.test(text)) payload = 'tel:'+text.replace(/\s/g,'');
      QRCode.toDataURL(payload, { margin:1, width:160 })
        .then(url=>{ state.qrDataUrl=url; $('qrImg').src=url; $('qrImg').classList.remove('hidden'); save(); })
        .catch(()=>{ $('qrImg').classList.add('hidden'); });
    }

    function renderAll(){ applyColors(); applyTemplate(); toggleSide(); }

    // ====== ë°”ì¸ë”© ======
    function bind(){
      $('name').value = state.name; $('title').value = state.title; $('phone').value = state.phone; $('bio').value = state.bio;
      $('email').value = state.email; $('website').value = state.website; $('address').value = state.address;
      $('bgColor').value = state.bgColor; $('textColor').value = state.textColor; $('fontFamily').value = state.fontFamily;
      $('side').value = state.side; $('template').value = String(state.template);

      const sync = (k, render = true) => (e)=>{ state[k]=e.target.value; save(); if(render) renderAll(); };
      $('name').addEventListener('input', sync('name')); $('title').addEventListener('input', sync('title'));
      $('phone').addEventListener('input', sync('phone')); $('bio').addEventListener('input', sync('bio'));
      $('email').addEventListener('input', (e)=>{ state.email=e.target.value; save(); updateQR(); renderAll(); });
      $('website').addEventListener('input', (e)=>{ state.website=e.target.value; save(); updateQR(); renderAll(); });
      $('address').addEventListener('input', sync('address'));
      $('bgColor').addEventListener('input', sync('bgColor'));
      $('textColor').addEventListener('input', sync('textColor'));
      $('fontFamily').addEventListener('change', sync('fontFamily'));
      $('side').addEventListener('change', (e)=>{ state.side=e.target.value; save(); toggleSide(); });
      $('template').addEventListener('change', (e)=>{ state.template = Number(e.target.value); save(); applyTemplate(); });

      $('logoInput').addEventListener('change', (e)=>{
        const f = e.target.files && e.target.files[0];
        if(!f){ state.logoDataUrl=''; $('logoImg').classList.add('hidden'); $('logoStatus').classList.add('hidden'); save(); return; }
        const reader = new FileReader();
        reader.onload = () => { state.logoDataUrl = String(reader.result); $('logoImg').src = state.logoDataUrl; $('logoImg').classList.remove('hidden'); $('logoStatus').classList.remove('hidden'); save(); };
        reader.readAsDataURL(f);
      });

      $('resetBtn').addEventListener('click', ()=>{ localStorage.removeItem(KEY); location.reload(); });

      // PC ë‹¤ìš´ë¡œë“œ
      const download = async (type='png') => {
        const canvas = await html2canvas(card, { backgroundColor: null, scale: 3, useCORS: true });
        canvas.toBlob((blob)=>{
          if(!blob) return;
          const a = document.createElement('a');
          a.href = URL.createObjectURL(blob);
          a.download = `${state.name||'card'}_${state.side}_${Date.now()}.` + (type==='jpg'?'jpg':type);
          a.click();
          setTimeout(()=> URL.revokeObjectURL(a.href), 10000);
        }, `image/${type==='jpg'?'jpeg':type}`);
      };
      $('savePngPc').addEventListener('click', ()=> download('png'));
      $('saveJpgPc').addEventListener('click', ()=> download('jpg'));

      // ëª¨ë°”ì¼ ê³µìœ /ê°¤ëŸ¬ë¦¬ ì €ì¥
      $('shareMobile').addEventListener('click', async ()=>{
        const canvas = await html2canvas(card, { backgroundColor: null, scale: 3, useCORS: true });
        canvas.toBlob(async (blob)=>{
          if(!blob) return;
          const file = new File([blob], `${state.name||'card'}_${state.side}.png`, { type: 'image/png' });
          if (navigator.canShare && navigator.canShare({ files:[file] })){
            try { await navigator.share({ files:[file], title:'ëª…í•¨ ì €ì¥', text:'ëª…í•¨ ì´ë¯¸ì§€ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.' }); }
            catch(e){}
          } else {
            const url = URL.createObjectURL(blob);
            window.open(url, '_blank');
            setTimeout(()=> URL.revokeObjectURL(url), 10000);
            alert('ì´ ë¸Œë¼ìš°ì €ëŠ” íŒŒì¼ ê³µìœ ê°€ ì œí•œë©ë‹ˆë‹¤. ìƒˆ ì°½ì—ì„œ ì´ë¯¸ì§€ë¥¼ ê¸¸ê²Œ ëˆŒëŸ¬ ì €ì¥í•˜ì„¸ìš”.');
          }
        }, 'image/png');
      });

      // ì¸ì‡„
      $('printBtn').addEventListener('click', ()=>{
        const w = window.open('', 'printWin'); if(!w) return;
        const html = `<!DOCTYPE html><html><head><meta charset='utf-8'><style>@page{size:86mm 54mm;margin:0}html,body{height:100%}body{display:grid;place-items:center;margin:0}</style></head><body>${card.outerHTML}</body></html>`;
        w.document.open(); w.document.write(html); w.document.close(); w.focus(); w.print();
      });
    }

    // ì´ˆê¸° ë Œë”
    bind(); updateQR(); renderAll();
  </script>
</body>
</html>
